{
  "tier": 3,
  "name": "CPP/EI Boundary Tests",
  "description": "Tests for CPP/EI contribution maximums and CPP2 calculations",
  "version": "2025-07",
  "collected_date": "2025-12-29",
  "pdoc_version": "T4127 - Version 2025-12-08",
  "tolerance": "0.05",
  "notes": "2025 limits: YMPE=$71,300, YAMPE=$81,200, EI MIE=$65,700",

  "test_cases": [
    {
      "id": "ON_72K_BIWEEKLY",
      "tier": 3,
      "description": "Ontario $72k - just above YMPE, CPP2 starts",
      "status": "VERIFIED",
      "category": "cpp2_start",
      "special_rules": ["CPP2 starts above YMPE"],
      "input": {
        "province": "ON",
        "gross_pay": "2769.23",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-07-18",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "0",
        "ytd_pensionable_earnings": "0",
        "ytd_insurable_earnings": "0",
        "ytd_cpp_base": "0",
        "ytd_cpp_additional": "0",
        "ytd_ei": "0"
      },
      "pdoc_expected": {
        "cpp_total": "156.76",
        "cpp_enhancement_f2": "26.35",
        "cpp2": "0.00",
        "ei": "45.42",
        "federal_tax": "300.23",
        "provincial_tax": "157.30",
        "total_deductions": "659.71",
        "net_pay": "2109.52"
      },
      "notes": "COLLECTED 2025-12-29 - CPP2=0 on first pay period (CPP2 calculated per-period on earnings above YMPE prorated threshold)"
    },
    {
      "id": "ON_82K_BIWEEKLY",
      "tier": 3,
      "description": "Ontario $82k - above YAMPE, CPP2 at ceiling",
      "status": "VERIFIED",
      "category": "cpp2_ceiling",
      "special_rules": ["CPP2 at maximum"],
      "input": {
        "province": "ON",
        "gross_pay": "3153.85",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-07-18",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "0",
        "ytd_pensionable_earnings": "0",
        "ytd_insurable_earnings": "0",
        "ytd_cpp_base": "0",
        "ytd_cpp_additional": "0",
        "ytd_ei": "0"
      },
      "pdoc_expected": {
        "cpp_total": "179.64",
        "cpp_enhancement_f2": "30.19",
        "cpp2": "0.00",
        "ei": "51.72",
        "federal_tax": "378.29",
        "provincial_tax": "197.91",
        "total_deductions": "807.56",
        "net_pay": "2346.29"
      },
      "notes": "COLLECTED 2025-12-29 - CPP2=0 on first pay period (CPP2 calculated per-period on earnings above YMPE prorated threshold)"
    },
    {
      "id": "ON_66K_BIWEEKLY",
      "tier": 3,
      "description": "Ontario $66k - at EI MIE threshold",
      "status": "VERIFIED",
      "category": "ei_maximum",
      "special_rules": ["EI at maximum rate"],
      "input": {
        "province": "ON",
        "gross_pay": "2538.46",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-07-18",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "0",
        "ytd_pensionable_earnings": "0",
        "ytd_insurable_earnings": "0",
        "ytd_cpp_base": "0",
        "ytd_cpp_additional": "0",
        "ytd_ei": "0"
      },
      "pdoc_expected": {
        "cpp_total": "143.03",
        "cpp_enhancement_f2": "24.04",
        "cpp2": "0.00",
        "ei": "41.63",
        "federal_tax": "254.80",
        "provincial_tax": "136.90",
        "total_deductions": "576.36",
        "net_pay": "1962.10"
      },
      "notes": "COLLECTED 2025-12-29 - $66k at EI MIE threshold, EI calculated at standard rate for first pay period"
    },
    {
      "id": "ON_80K_YTD_CPP_NEAR_MAX",
      "tier": 3,
      "description": "Ontario $80k with YTD CPP near max - partial CPP deduction",
      "status": "VERIFIED",
      "category": "ytd_near_max",
      "special_rules": ["Partial CPP due to YTD"],
      "input": {
        "province": "ON",
        "gross_pay": "3076.92",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-11-14",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "60000.00",
        "ytd_pensionable_earnings": "60000.00",
        "ytd_insurable_earnings": "60000.00",
        "ytd_cpp_base": "3300.00",
        "ytd_cpp_additional": "0",
        "ytd_ei": "900.00",
        "pensionable_months": "10"
      },
      "pdoc_expected": {
        "cpp_total": "61.75",
        "cpp_enhancement_f2": "133.46",
        "cpp2": "123.08",
        "ei": "50.46",
        "federal_tax": "344.36",
        "provincial_tax": "182.50",
        "total_deductions": "762.15",
        "net_pay": "2314.77"
      },
      "notes": "COLLECTED 2025-12-29 - YTD CPP adjusted to 3300 (PDOC max is 3361.75). Partial base CPP (61.75) to reach max. CPP2=123.08 for earnings above YMPE threshold."
    },
    {
      "id": "ON_70K_YTD_EI_NEAR_MAX",
      "tier": 3,
      "description": "Ontario $70k with YTD EI near max - partial EI deduction",
      "status": "VERIFIED",
      "category": "ytd_near_max",
      "special_rules": ["Partial EI due to YTD"],
      "input": {
        "province": "ON",
        "gross_pay": "2692.31",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-11-14",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "52496.00",
        "ytd_pensionable_earnings": "52496.00",
        "ytd_insurable_earnings": "52500.00",
        "ytd_cpp_base": "2950.00",
        "ytd_cpp_additional": "0",
        "ytd_ei": "1050.00",
        "pensionable_months": "10"
      },
      "pdoc_expected": {
        "cpp_total": "152.18",
        "cpp_enhancement_f2": "25.58",
        "cpp2": "0.00",
        "ei": "27.48",
        "federal_tax": "287.77",
        "provincial_tax": "151.47",
        "total_deductions": "618.90",
        "net_pay": "2073.41"
      },
      "notes": "COLLECTED 2025-12-29 - YTD values adjusted for PDOC consistency. Partial EI ($27.48) to reach max of $1,077.48."
    },
    {
      "id": "ON_100K_ALL_MAXED",
      "tier": 3,
      "description": "Ontario $100k with all YTD maxed - zero CPP/EI",
      "status": "VERIFIED",
      "category": "all_maxed",
      "special_rules": ["Zero CPP/EI - all maxed"],
      "input": {
        "province": "ON",
        "gross_pay": "3846.15",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-12-12",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "96153.85",
        "ytd_pensionable_earnings": "81200.00",
        "ytd_insurable_earnings": "65700.00",
        "ytd_cpp_base": "4034.10",
        "ytd_cpp_additional": "396.00",
        "ytd_ei": "1077.48",
        "cpp_max_reached": true,
        "ei_max_reached": true
      },
      "pdoc_expected": {
        "cpp_total": "0.00",
        "cpp_enhancement_f2": "0.00",
        "cpp2": "0.00",
        "ei": "0.00",
        "federal_tax": "526.40",
        "provincial_tax": "267.13",
        "total_deductions": "793.53",
        "net_pay": "3052.62"
      },
      "notes": "COLLECTED 2025-12-29 - All CPP/EI maxed, zero contributions. Using 'max reached' option in PDOC."
    },
    {
      "id": "AB_85K_CPP2",
      "tier": 3,
      "description": "Alberta $85k - CPP2 range verification",
      "status": "VERIFIED",
      "category": "cpp2_verification",
      "special_rules": ["CPP2 in range", "Alberta flat rate"],
      "input": {
        "province": "AB",
        "gross_pay": "3269.23",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-07-18",
        "federal_claim": "16129.00",
        "provincial_claim": "22323.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "0",
        "ytd_pensionable_earnings": "0",
        "ytd_insurable_earnings": "0",
        "ytd_cpp_base": "0",
        "ytd_cpp_additional": "0",
        "ytd_ei": "0"
      },
      "pdoc_expected": {
        "cpp_total": "186.51",
        "cpp_enhancement_f2": "31.35",
        "cpp2": "0.00",
        "ei": "53.62",
        "federal_tax": "401.70",
        "provincial_tax": "169.73",
        "total_deductions": "811.56",
        "net_pay": "2457.67"
      },
      "notes": "COLLECTED 2025-12-29 - CPP2=0 on first pay period. Alberta flat rate provincial tax."
    },
    {
      "id": "BC_90K_CPP2_TAX_REDUCTION",
      "tier": 3,
      "description": "BC $90k - CPP2 + tax reduction combined rules",
      "status": "VERIFIED",
      "category": "combined_rules",
      "special_rules": ["CPP2", "Tax reduction interaction"],
      "input": {
        "province": "BC",
        "gross_pay": "3461.54",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-07-18",
        "federal_claim": "16129.00",
        "provincial_claim": "12932.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "0",
        "ytd_pensionable_earnings": "0",
        "ytd_insurable_earnings": "0",
        "ytd_cpp_base": "0",
        "ytd_cpp_additional": "0",
        "ytd_ei": "0"
      },
      "pdoc_expected": {
        "cpp_total": "197.95",
        "cpp_enhancement_f2": "33.27",
        "cpp2": "0.00",
        "ei": "56.77",
        "federal_tax": "440.73",
        "provincial_tax": "180.14",
        "total_deductions": "875.59",
        "net_pay": "2585.95"
      },
      "notes": "COLLECTED 2025-12-29 - CPP2=0 on first pay period. BC tax reduction applies to provincial tax."
    },
    {
      "id": "ON_80K_CPP_REACHES_MAX_K2",
      "tier": 3,
      "description": "Ontario $80k with CPP reaching max in current period - triggers K2 P-1 logic",
      "status": "VERIFIED",
      "category": "k2_effective_periods",
      "special_rules": ["K2 P-1 logic", "CPP reaches max in period"],
      "input": {
        "province": "ON",
        "gross_pay": "3076.92",
        "pay_frequency": "biweekly",
        "pay_periods": 26,
        "pay_date": "2025-11-14",
        "federal_claim": "16129.00",
        "provincial_claim": "12747.00",
        "rrsp": "0",
        "union_dues": "0",
        "ytd_gross": "66000.00",
        "ytd_pensionable_earnings": "66000.00",
        "ytd_insurable_earnings": "62623.68",
        "ytd_cpp_base": "3900.00",
        "ytd_cpp_additional": "0",
        "ytd_ei": "1000.00",
        "pensionable_months": "12"
      },
      "pdoc_expected": {
        "cpp_total": "134.10",
        "cpp_enhancement_f2": "22.54",
        "cpp2": "0.00",
        "ei": "50.46",
        "federal_tax": "364.68",
        "provincial_tax": "191.78",
        "total_deductions": "741.02",
        "net_pay": "2335.90"
      },
      "notes": "COLLECTED 2025-12-30 - K2 effective periods test. YTD CPP base ($3,900) + current period CPP ($134.10) = $4,034.10 (max). This triggers the K2 P-1 logic where effective_periods = P - 1 for annualized tax credit calculation. PDOC used ytd_insurable_earnings=65700, ytd_ei=1000."
    }
  ]
}
