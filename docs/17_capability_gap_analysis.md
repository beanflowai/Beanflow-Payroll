# Beanflow-Payroll 能力差距分析

**文档版本**: 1.0
**最后更新**: 2026-01-01
**分析基准**: 加拿大 Payroll 专业人员实际工作需求

---

## 概述

本文档客观分析 Beanflow-Payroll 系统相对于实际 payroll 工作需求的能力覆盖情况，识别差距并提供优先级建议。

### 为什么需要 Payroll 培训和认证？

加拿大有 **National Payroll Institute (NPI)** 提供专业认证：
- **PCP** (Payroll Compliance Practitioner) - 入门级
- **CPM** (Certified Payroll Manager) - 高级管理

Payroll 工作的复杂性体现在：

| 痛点 | 说明 |
|------|------|
| **法规复杂度** | 联邦税 + 13个省/地区的不同税率和规则 |
| **频繁变更** | 每年1月、7月税率变更，各省随时可能调整 |
| **精确性要求** | 多种 pay frequency、年化收入计算、特殊税务处理 |
| **申报负担** | CRA Remittance、T4、ROE、WSIB 等多种申报 |
| **边界情况多** | 入离职、病假产假、应税福利、跨年度调整 |
| **责任重大** | 计算错误导致投诉、罚款、甚至法律责任 |

---

## 总体评估

| 维度 | 系统能力 | 评分 |
|------|---------|------|
| **计算准确性** | 强 | ⭐⭐⭐⭐⭐ |
| **法规覆盖** | 较强 | ⭐⭐⭐⭐ |
| **合规申报** | 弱 | ⭐⭐ |
| **自动化程度** | 中等 | ⭐⭐⭐ |
| **边界情况** | 部分 | ⭐⭐⭐ |

**总体覆盖率**: 约 60%

---

## 已解决的痛点 ✅

### 1. 计算复杂度 → 完全解决

| 需求 | 系统能力 |
|------|---------|
| 13个省的不同税率 | 12 省完整支持（除 Quebec） |
| CPP/EI 规则复杂 | CPP Base + CPP2 + 雇主贡献 |
| 联邦/省税计算 | T4127 标准公式实现 |
| 准确性验证 | 998 个测试 + PDOC 验证 |

**实现细节**:
- `backend/app/services/payroll/payroll_engine.py` - 核心计算引擎
- `backend/app/services/payroll/cpp_calculator.py` - CPP 计算
- `backend/app/services/payroll/ei_calculator.py` - EI 计算
- `backend/app/services/payroll/federal_tax_calculator.py` - 联邦税
- `backend/app/services/payroll/provincial_tax_calculator.py` - 省税

### 2. 年度法规变更 → 基本解决

| 需求 | 系统能力 |
|------|---------|
| 年度税率更新 | 配置化税表 (2024/2025/2026) |
| 年中变更 | 版本化配置 (jan/jul 分开) |
| 2025-07-01 联邦变更 | 已实现 (15% → 14%) |

**配置位置**: `backend/config/tax_tables/`

**局限**: 需要人工更新配置文件，无自动法规更新推送

### 3. 省级差异 → 解决

| 省级规则 | 系统支持 |
|---------|---------|
| 假日工资规则 | 12 省 Tier 1/2/3 配置 |
| 病假规则 | 12 省带薪/无薪配置 |
| 度假工资规则 | 12 省应计/支付配置 |
| 动态 BPA | MB, NS, YT 支持 |

**配置位置**:
- `backend/config/holiday_pay/`
- `backend/config/sick_leave/`
- `backend/config/vacation_pay/`

### 4. 薪资单生成 → 解决

| 需求 | 系统能力 |
|------|---------|
| PDF 生成 | ReportLab 自动生成 |
| 省份特定显示 | ON 度假、BC 雇主贡献 |
| 存储和访问 | DigitalOcean Spaces + Pre-signed URL |
| 员工自助 | 员工门户下载 |

**实现**: `backend/app/services/payroll/paystub_generator.py`

### 5. YTD 追踪 → 解决

| 需求 | 系统能力 |
|------|---------|
| 年度累计计算 | 自动 YTD 计算 |
| 最大值检测 | CPP/EI 年度最大值追踪 |
| 历史准确性 | 员工快照机制 |

**实现**: `backend/app/services/payroll_run/ytd_calculator.py`

---

## 部分解决的痛点 ⚠️

### 1. 汇款管理 → 部分解决

| 功能 | 状态 | 说明 |
|------|------|------|
| PD7A PDF 生成 | ✅ | 可生成汇款凭证 |
| 汇款期间计算 | ✅ | 支持多种频率 |
| 汇款摘要报告 | ✅ | 支持报表查看 |
| AMWA 计算 | ❌ | 平均月度预扣未实现 |
| 迟缴罚款预警 | ❌ | 无预警机制 |
| 汇款人分类 | ❌ | regular/quarterly/accelerated 未区分 |
| 自动汇款提交 | ❌ | 无 CRA 集成 |

**实现**: `backend/app/services/remittance/`

### 2. 多种收入/扣款类型 → 大部分解决

| 类型 | 状态 |
|------|------|
| 常规工资、加班、假日、度假 | ✅ |
| 应税福利 | ✅ |
| RRSP、工会费 | ✅ |
| 税前/税后扣款 | ✅ |
| 扣押 (Garnishment) | ❌ |
| 子女抚养令扣款 | ❌ |
| 股票期权 | ❌ |

### 3. 员工生命周期 → 部分解决

| 场景 | 状态 |
|------|------|
| 入职、薪酬变更 | ✅ |
| 终止 | ✅ |
| 产假/育儿假 EI 处理 | ❌ |
| 跨省转移 | ❌ |
| 多雇主场景 | ❌ |

---

## 未解决的痛点 ❌

### 1. T4 年终报税 → 未实现

| 需求 | 重要性 | 状态 |
|------|--------|------|
| T4 数据聚合 | 必需 | Phase 6 未开始 |
| T4 PDF 生成 | 必需 | Phase 6 未开始 |
| T4 XML (T619) | 必需 | Phase 6 未开始 |
| T4 Summary | 必需 | Phase 6 未开始 |
| CRA 电子提交 | 高度期望 | Phase 8 未开始 |

**影响**: 用户每年2月底前必须另找工具处理年终报税

**规划文档**: `docs/09_year_end_processing.md`

### 2. ROE (离职记录) → 未实现

| 需求 | 重要性 | 状态 |
|------|--------|------|
| ROE 数据生成 | 必需 | Phase 7 未开始 |
| ROE XML (.BLK) | 必需 | Phase 7 未开始 |
| ROE PDF | 建议 | Phase 7 未开始 |
| Service Canada 提交 | 高度期望 | Phase 8 未开始 |

**影响**: 员工离职后 5 天内必须手动处理 ROE，影响员工 EI 申领

**规划文档**: `docs/11_roe_generation.md`

### 3. Quebec 支持 → 不支持

| Quebec 特殊性 | 说明 |
|--------------|------|
| QPP | 替代 CPP 的独立系统 |
| QPIP | 魁北克父母保险计划 |
| Revenu Québec | 独立省税系统 |

**市场影响**: 无法服务约 23% 加拿大人口

**决策理由**: 开发成本高，优先覆盖其他 12 个省份

### 4. 政府电子提交 → 未实现

| 功能 | 状态 |
|------|------|
| CRA My Business Account 集成 | Phase 8 |
| ROE Web 自动提交 | Phase 8 |
| 汇款自动提交 | Phase 8 |

**规划文档**: `docs/16_government_electronic_submission.md`

### 5. 合规预警系统 → 缺失

| 缺失功能 |
|---------|
| 汇款截止日提醒 |
| T4 截止日提醒 |
| 法规变更通知 |
| 合规健康检查 |
| 逾期风险预警 |

---

## 竞品对比

| 功能 | Beanflow | Wagepoint | Ceridian | ADP |
|------|----------|-----------|----------|-----|
| 薪资计算 | ✅ | ✅ | ✅ | ✅ |
| T4 生成 | ❌ | ✅ | ✅ | ✅ |
| ROE 生成 | ❌ | ✅ | ✅ | ✅ |
| 自动汇款 | ❌ | ✅ | ✅ | ✅ |
| Quebec | ❌ | ✅ | ✅ | ✅ |
| 员工门户 | ✅ | ✅ | ✅ | ✅ |
| 合规自动更新 | 手动 | 自动 | 自动 | 自动 |
| 定价 | - | $$ | $$$$ | $$$$ |

---

## 目标客户定位

### 适合的客户

- 小型企业 (1-50 员工)
- 非 Quebec 省份
- 愿意手动处理 T4/ROE 的用户
- 成本敏感型客户
- 使用 Beanflow + 其他工具组合的用户

### 不适合的客户

- 需要完整合规方案的企业
- Quebec 雇主
- 大型企业（需要自动化申报）
- 合规要求严格的行业

---

## 优先级建议

### P0 - 必须完成（影响基本可用性）

| 功能 | 价值 | 工作量 | 目标 |
|------|------|--------|------|
| T4 生成 | 年终必需，无此功能用户必须换工具 | 中 | Q1 |
| ROE 生成 | 员工离职必需，法律要求 | 中 | Q1 |

### P1 - 高优先级（显著提升价值）

| 功能 | 价值 | 工作量 |
|------|------|--------|
| 合规日历/提醒 | 减少漏报风险，提升用户信任 | 小 |
| 扣押管理 | 法院命令扣款是常见需求 | 中 |

### P2 - 中优先级（增强竞争力）

| 功能 | 价值 | 工作量 |
|------|------|--------|
| 自动法规更新 | 减少维护成本，提升用户体验 | 大 |
| 高级报表 | 满足分析需求 | 中 |

### P3 - 低优先级（市场扩展）

| 功能 | 价值 | 工作量 |
|------|------|--------|
| Quebec 支持 | 扩大市场 23% | 大 |
| 政府自动提交 | 高端差异化功能 | 大 |

---

## 结论

### 当前定位

**Beanflow-Payroll 是一个优秀的薪资计算引擎，但还不是完整的 payroll 解决方案。**

### 能力矩阵

```
┌─────────────────────────────────────────────────────────────┐
│                    Payroll 工作完整流程                      │
├─────────────────────────────────────────────────────────────┤
│  ✅ 员工管理    ✅ 薪资计算    ✅ 薪资单生成                  │
│  ✅ YTD 追踪    ⚠️ 汇款管理    ❌ T4 年终                     │
│  ❌ ROE 生成    ❌ 政府提交    ❌ Quebec                      │
└─────────────────────────────────────────────────────────────┘

覆盖率: ████████░░░░ 60%
```

### 达到完整解决方案需要

1. **必须**: T4 生成 + ROE 生成
2. **建议**: 合规提醒 + 扣押管理
3. **可选**: Quebec 支持 + 政府自动提交

### 预计完成时间

- 完成 P0 (T4 + ROE): 可达到 ~80% 覆盖率
- 完成 P0 + P1: 可达到 ~90% 覆盖率
- 完成全部: 可达到 ~100% 覆盖率（含 Quebec）

---

## 相关文档

- [实现进度清单](./implementation_checklist.md)
- [T4 年终处理规划](./09_year_end_processing.md)
- [ROE 生成规划](./11_roe_generation.md)
- [汇款报告规划](./10_remittance_reporting.md)
- [政府电子提交规划](./16_government_electronic_submission.md)

---

*本文档应随系统功能更新而更新，建议每个 Phase 完成后重新评估。*
